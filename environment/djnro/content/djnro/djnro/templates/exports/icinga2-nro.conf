{% for s in nroservers %}

object Host "{{s.name}}" {
  import "eduroam-radius-host"

  // check if this is an IPv6 address
  {% if ":" in s.host %}
  address6 = "{{s.host}}"
  {% else %}
  address = "{{s.host}}"
  {% endif %}

  vars.eduroam_secret = "{{s.secret}}"
  vars.eduroam_port = "{{s.port}}"

  // conditionally define whether to monitor status server
  {% if s.status_server %}
  vars.eduroam_status_server = "true"
  {% endif %}

  // now generate an entry for each monitored realm
  {% for irm in instrealmmons %}
  {% if irm.mon_type == 'localauthn' and irm.monlocalauthnparam %}
  vars.eduroam_details["{{ "eduroam-"|add:irm.realm.realm|add:'-'|add:irm.mon_type }}"] = {
      eduroam_user = "{{ irm.monlocalauthnparam.username }}"
      eduroam_password = "{{ irm.monlocalauthnparam.passp }}"
      eduroam_method = "WPA-EAP"
      eduroam_eap_method = "{{ irm.monlocalauthnparam.eap_method }}"
      eduroam_phase2 = "{{ irm.monlocalauthnparam.phase2 }}"
  }
  {% endif %}
  {% endfor %}

  // notify all admins
  vars.notification["mail"] = {
    groups = [ "icingaadmins" ]
  }

}

{% endfor %}
